<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36" version="24.7.6">
  <diagram name="第 1 页" id="KPa0spre10BV23PreFPN">
    <mxGraphModel dx="954" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="0" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-35" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad7ac;strokeColor=#b46504;" parent="1" vertex="1">
          <mxGeometry x="215" y="1330" width="405" height="250" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-1" value="&lt;b&gt;Mongo 分库分表：&amp;nbsp;&lt;/b&gt;&lt;div&gt;主表都配置了TTL 能力，对于迁移的数据，时间过了就自动清理&lt;/div&gt;&lt;div&gt;对于迁移表可以支持不加TTL,实现数据全量；&lt;/div&gt;&lt;div&gt;支持数据切表，冷热数据&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="60" y="40" width="360" height="70" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-2" value="配置服务" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="170" y="120" width="60" height="290" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-4" value="读路由服务" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="260" y="120" width="70" height="290" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-5" value="写路由服务" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="411" y="110" width="70" height="290" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-6" value="数据迁移服务" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="523" y="110" width="70" height="290" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-8" style="edgeStyle=elbowEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;elbow=vertical;curved=0;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="100" y="320" as="sourcePoint" />
            <mxPoint x="200" y="320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="160.5" y="320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-7" value="事件" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="70" y="120" width="60" height="300" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-9" value="新增路由配置：&lt;div&gt;将某个产品写入新表：&lt;/div&gt;&lt;div&gt;迁移时间戳：迁移服务会进行迁移&lt;/div&gt;&lt;div&gt;读主表：读取路由读取标识&lt;/div&gt;&lt;div&gt;写主表：写路由是否双写&lt;/div&gt;&lt;div&gt;迁移状态：保证只有一个迁移&lt;/div&gt;&lt;div&gt;结束时间：标识切表时间点&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="20" y="165" width="200" height="110" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-10" value="创建迁移任务" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="85" y="290" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-11" value="定时检查配置任务：&lt;div&gt;发现迁移任务：开始迁移&lt;/div&gt;&lt;div&gt;支持全量迁移和部分迁移&lt;/div&gt;&lt;div&gt;迁移完成：更新配置状态&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="520" y="165" width="160" height="70" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-12" value="1. 定时任务检查&lt;div&gt;配置信息&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="240" y="170" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-13" value="2. 查询数据时，&lt;div&gt;查看路由配置：&lt;div&gt;不存在独立配置：&lt;/div&gt;&lt;div&gt;直接读取主表&lt;/div&gt;&lt;div&gt;存在独立配置：&lt;/div&gt;&lt;div&gt;如果只存在一个配置：&lt;/div&gt;&lt;div&gt;如果迁移中，&lt;span style=&quot;background-color: initial;&quot;&gt;读取主表&lt;/span&gt;&lt;/div&gt;&lt;div&gt;如果迁移完成：读取配置表&lt;/div&gt;&lt;/div&gt;&lt;div&gt;如果存在读个配置：&lt;/div&gt;&lt;div&gt;根据时间排序配置&lt;/div&gt;&lt;div&gt;选择配置表进行查询&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="244" y="210" width="170" height="170" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-14" value="2. 写入数据时，&lt;div&gt;查看路由配置：&lt;/div&gt;&lt;div&gt;不存在独立配置，写入主表&lt;/div&gt;&lt;div&gt;存在独立配置：&lt;/div&gt;&lt;div&gt;如果只存在一个配置：&lt;/div&gt;&lt;div&gt;如果迁移中：双写主表和指定表&lt;/div&gt;&lt;div&gt;如果迁移完成：写入执行配置表&lt;/div&gt;&lt;div&gt;如果存在多个配置：表示切表&lt;/div&gt;&lt;div&gt;数据写入最新表&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="400" y="245" width="190" height="140" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-15" value="1. 定时任务检查&lt;div&gt;配置信息&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="390" y="180" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-16" value="&lt;b&gt;Pulsar Starter 设计：&lt;/b&gt;&lt;div&gt;支持PulsarTemplate,PulsarStringTemplate&lt;/div&gt;&lt;div&gt;支持注解订阅pulsar 消息&lt;/div&gt;&lt;div&gt;支持多种消息提交模式：手动，count_time,立即&lt;/div&gt;&lt;div&gt;支持容器生命周期管理，消费者优雅停&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="49" y="510" width="271" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-20" value="@EnablePulsar/&lt;div&gt;@PulsarSubscribe&lt;/div&gt;" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="60" y="640" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-26" style="edgeStyle=elbowEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;elbow=vertical;curved=0;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="234" y="870" as="sourcePoint" />
            <mxPoint x="369" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-21" value="PulsarAnnotation&lt;div&gt;Processor&lt;/div&gt;" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="185" y="640" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-22" value="1. 使用EnablePulsar注解：&lt;div&gt;开启注解扫描Processor&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;2. PulsarSubscribe 注解：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;用于订阅pulsar topic 消息&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="25" y="700" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-23" value="当注册了Processor bean:&lt;div&gt;1. 实现BeanPostProcessor&lt;/div&gt;&lt;div&gt;2. 扫描所有的bean, 并读取其方法&lt;/div&gt;&lt;div&gt;3. 找到使用PulsarSubscribe 注解&lt;/div&gt;&lt;div&gt;4. 构建SubscirbeHolder&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="135" y="760" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-29" style="edgeStyle=elbowEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;elbow=vertical;curved=0;" parent="1" target="VRjen7JTUJrRjUqwProS-28" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="369.5" y="890" as="sourcePoint" />
            <mxPoint x="494.5" y="890" as="targetPoint" />
            <Array as="points">
              <mxPoint x="510" y="920" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-24" value="SubscribeHolder&lt;div&gt;Registrar&lt;br&gt;&lt;/div&gt;" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="320" y="640" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-27" value="5. 注册Holder到注册中心" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="220" y="840" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-28" value="&lt;div&gt;PulsarContainer&lt;br&gt;&lt;/div&gt;" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="472" y="640" width="100" height="350" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-31" value="监听ApplicationReadyEvent：&lt;div&gt;注册Holder到container&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="292" y="700" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-32" value="6. 注册Holders 到&lt;div&gt;contianer&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="380" y="880" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-33" value="1. 实现SmartInitializingSingleton：&lt;div&gt;初始化完成后根据配置创建Producer&lt;/div&gt;&lt;div&gt;2. 实现SmartLifecycle&lt;/div&gt;&lt;div&gt;管理容器的生命周期，在停止时，&lt;/div&gt;&lt;div&gt;停止消费者继续进行消费，&lt;/div&gt;&lt;div&gt;同时提交当前已经消费的数据&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. 容器具有配置属性：Ack提交策略。&lt;/div&gt;&lt;div&gt;默认是count_time;也可配置逐条立即提交&lt;/div&gt;&lt;div&gt;同时支持手动提交：&lt;/div&gt;&lt;div&gt;注解方法一个参数，容器提交&lt;/div&gt;&lt;div&gt;注解方法两个参数，参数一是消费者&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="460" y="680" width="240" height="200" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-34" value="将Holder 转换为pulsar消费者，&lt;div&gt;并代理方法进行发射调用&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="440" y="920" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-35" value="ProducerTemplate" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="650" y="640" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-36" value="依赖container:&lt;div&gt;通过container 获取producer&lt;/div&gt;&lt;div&gt;适配发送接口实现消息发送&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="670" y="710" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-37" value="ES 选主流程" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="54" y="1005" width="81" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="VRjen7JTUJrRjUqwProS-38" target="VRjen7JTUJrRjUqwProS-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-38" value="当es 重启或者&lt;div&gt;mster节崩溃&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="1050" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="VRjen7JTUJrRjUqwProS-39" target="VRjen7JTUJrRjUqwProS-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-39" value="发起广播投票自己为master" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="294" y="1050" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="VRjen7JTUJrRjUqwProS-40" target="VRjen7JTUJrRjUqwProS-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-40" value="是否为master资格节点" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="161" y="1035" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-45" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="250" y="1048" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="VRjen7JTUJrRjUqwProS-46" target="VRjen7JTUJrRjUqwProS-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-46" value="版本高，&lt;div&gt;ID节点小&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="420" y="1035" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="VRjen7JTUJrRjUqwProS-48" target="VRjen7JTUJrRjUqwProS-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-48" value="成为master" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="538" y="1050" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="VRjen7JTUJrRjUqwProS-50" value="通知其他节点" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="625" y="1050" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-1" value="DDD:领域驱动设计" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="770" y="70" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-13" value="XXL-JOB" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1785" y="48" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-2" value="&lt;b&gt;DDD: 领域驱动设计&lt;/b&gt;" style="shape=umlFrame;html=1;pointerEvents=0;width=120;height=20;labelBackgroundColor=#FFCC99;swimlaneFillColor=#FFE6CC;fillColor=#f8cecc;strokeColor=#b85450;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="930" y="150" width="810" height="460" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-14" value="&lt;b&gt;核心理论&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="935" y="188" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-15" value="分层结构" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.basic.layered_rect;dx=10;outlineConnect=0;whiteSpace=wrap;fillColor=#fa6800;fontColor=#000000;strokeColor=#C73500;" parent="1" vertex="1">
          <mxGeometry x="960" y="229" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-16" value="领域模型" style="sketch=0;outlineConnect=0;fontColor=#000000;fillColor=#f0a30a;strokeColor=#BD7000;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.sagemaker_model;" parent="1" vertex="1">
          <mxGeometry x="960" y="380" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-33" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;&lt;b&gt;转换为DTO，调用应用服务&lt;/b&gt;&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="9D-Lmr6SBzClbS9fGLFk-20" target="9D-Lmr6SBzClbS9fGLFk-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-20" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad7ac;strokeColor=#b46504;" parent="1" vertex="1">
          <mxGeometry x="1230" y="183" width="350" height="62" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-21" value="&lt;b&gt;Adpter层(表现层)&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1345" y="182" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-23" value="Controller" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1231" y="215" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="9D-Lmr6SBzClbS9fGLFk-26" target="9D-Lmr6SBzClbS9fGLFk-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-61" value="&lt;b&gt;转换领域事件，调用领域服务&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="9D-Lmr6SBzClbS9fGLFk-53" vertex="1" connectable="0">
          <mxGeometry x="-0.3131" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="9D-Lmr6SBzClbS9fGLFk-37" target="9D-Lmr6SBzClbS9fGLFk-54" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1580" y="320" />
              <mxPoint x="1670" y="320" />
              <mxPoint x="1670" y="551" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-67" value="&lt;b&gt;领域事件发布等操作&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="9D-Lmr6SBzClbS9fGLFk-66" vertex="1" connectable="0">
          <mxGeometry x="0.0193" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-26" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="1230" y="289" width="350" height="62" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-27" value="&lt;b&gt;App层(数据转换校验)&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1335" y="291" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-30" value="VO" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1325" y="215" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-34" value="DTO" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1231" y="321" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-35" value="Service" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1326" y="321" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-36" value="Scheduler" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1417" y="321" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-37" value="Consumer" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1510" y="321" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-46" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="1" vertex="1">
          <mxGeometry x="1231" y="400" width="347" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-47" value="&lt;b&gt;Domain层(领域业务)&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1336" y="398" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-48" value="领域服务" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1232" y="429" width="58" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-49" value="聚合根" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1301" y="429" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-50" value="SPI" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1375" y="429" width="59" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-51" value="repository" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1445" y="430" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="9D-Lmr6SBzClbS9fGLFk-54" target="9D-Lmr6SBzClbS9fGLFk-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-64" value="&lt;b&gt;领域SPI和repo 具体实现&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="9D-Lmr6SBzClbS9fGLFk-63" vertex="1" connectable="0">
          <mxGeometry x="0.1475" y="2" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-54" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="1231" y="521" width="347" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-55" value="&lt;b&gt;Infrastructrue层(基础组件层)&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1316" y="519" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-56" value="SPI&amp;nbsp;&lt;div&gt;impl&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1232" y="550" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-57" value="mapper" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1321" y="550" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-58" value="config" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1418" y="550" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-65" value="component" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1508" y="550" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9D-Lmr6SBzClbS9fGLFk-70" value="领域模型层必须依赖独立，领域服务通过&#xa;处理领域事件转换聚合根；同时定义SPI解耦实现" style="shape=note;backgroundOutline=1;darkOpacity=0.05;align=left;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="1060" y="332" width="120" height="88" as="geometry" />
        </mxCell>
        <mxCell id="6UzdkExmgidhG1JHYg0t-1" value="领域事件" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="1519" y="429" width="59" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T2ZMbrgRlUznVUn5AD8o-2" value="&lt;b&gt;聚合根： 将查询，业务处理和修改分离，先查询聚合数据，再业务处理，再事物进行数据修改&lt;/b&gt;" style="shape=note;backgroundOutline=1;darkOpacity=0.05;align=left;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1060" y="440" width="120" height="88" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-1" value="&lt;b&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;kafka&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="210" y="1190" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-2" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=5;rounded=0;strokeColor=#FF0080;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="40" y="1159" as="sourcePoint" />
            <mxPoint x="830" y="1159" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-3" value="生产者" style="swimlane;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="4.75" y="1860" width="175.25" height="700" as="geometry">
            <mxRectangle x="166.16" y="5020" width="90" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-4" value="&lt;b&gt;场景三：结算下发认领单&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="J3ipS8W6sBXHcmSZQY-d-3" vertex="1">
          <mxGeometry x="10" y="50" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-5" value="结算下发认领单" style="whiteSpace=wrap;html=1;fillColor=#b1ddf0;strokeColor=#10739e;" parent="J3ipS8W6sBXHcmSZQY-d-3" vertex="1">
          <mxGeometry x="33.370000000000005" y="101" width="118.27" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-6" value="Broker" style="swimlane;whiteSpace=wrap;startSize=23;" parent="1" vertex="1">
          <mxGeometry x="180" y="1860" width="470" height="700" as="geometry">
            <mxRectangle x="166.16" y="5020" width="90" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="J3ipS8W6sBXHcmSZQY-d-6" source="J3ipS8W6sBXHcmSZQY-d-7" target="ohOXor32xnlO2z5g4up4-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-7" value="当消费者加入/离开；&#xa;或者新加topic/分区" style="whiteSpace=wrap;" parent="J3ipS8W6sBXHcmSZQY-d-6" vertex="1">
          <mxGeometry x="2.7500000000002274" y="80" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-13" value="&lt;b&gt;场景1:消费者组重平衡&lt;/b&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="J3ipS8W6sBXHcmSZQY-d-6" vertex="1">
          <mxGeometry x="19.75" y="40" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-1" value="broker controller 检测到消费者组变化，触发重平衡" style="whiteSpace=wrap;" vertex="1" parent="J3ipS8W6sBXHcmSZQY-d-6">
          <mxGeometry x="164.75000000000023" y="80" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="J3ipS8W6sBXHcmSZQY-d-6" source="ohOXor32xnlO2z5g4up4-5" target="ohOXor32xnlO2z5g4up4-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="406" y="140" />
              <mxPoint x="65" y="140" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-5" value="组下消费者都发送JoinGroup 请求" style="whiteSpace=wrap;" vertex="1" parent="J3ipS8W6sBXHcmSZQY-d-6">
          <mxGeometry x="336.0000000000002" y="78" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-12" value="协调者会将第一个发送JoinGroup&lt;div&gt;的消费者作为leader消费者&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="J3ipS8W6sBXHcmSZQY-d-6" source="ohOXor32xnlO2z5g4up4-8" target="ohOXor32xnlO2z5g4up4-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-8" value="协调组收到所有消费者订阅信息" style="whiteSpace=wrap;" vertex="1" parent="J3ipS8W6sBXHcmSZQY-d-6">
          <mxGeometry x="2.7500000000002274" y="160" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-14" value="根据配置的平衡策略&lt;div&gt;分配消费分区&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="J3ipS8W6sBXHcmSZQY-d-6" source="ohOXor32xnlO2z5g4up4-11" target="ohOXor32xnlO2z5g4up4-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="375" y="220" />
              <mxPoint x="65" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-11" value="发送所有消费者的订阅信息到leader 消费者" style="whiteSpace=wrap;" vertex="1" parent="J3ipS8W6sBXHcmSZQY-d-6">
          <mxGeometry x="310.0000000000002" y="160" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-16" value="协调者发送SyncGroup请求&lt;div&gt;发送分配信息给所有消费者&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="J3ipS8W6sBXHcmSZQY-d-6" source="ohOXor32xnlO2z5g4up4-13" target="ohOXor32xnlO2z5g4up4-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-13" value="发送分配信息到协调者" style="whiteSpace=wrap;" vertex="1" parent="J3ipS8W6sBXHcmSZQY-d-6">
          <mxGeometry x="3.7500000000002274" y="250" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-15" value="消费者根据分配消费分区消息" style="whiteSpace=wrap;" vertex="1" parent="J3ipS8W6sBXHcmSZQY-d-6">
          <mxGeometry x="300.0000000000002" y="250" width="129" height="43" as="geometry" />
        </mxCell>
        <mxCell id="ohOXor32xnlO2z5g4up4-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.008;entryY=0.535;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="J3ipS8W6sBXHcmSZQY-d-6" source="ohOXor32xnlO2z5g4up4-1" target="ohOXor32xnlO2z5g4up4-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-8" value="消费者" style="swimlane;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="650" y="1860" width="137.75" height="700" as="geometry">
            <mxRectangle x="166.16" y="5020" width="90" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-9" value="zookeeper" style="swimlane;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="787.75" y="1860" width="141.25" height="700" as="geometry">
            <mxRectangle x="166.16" y="5020" width="90" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-11" value="&lt;b&gt;setp1: 创建topic&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="805" y="1888" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-16" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="1" vertex="1">
          <mxGeometry x="215" y="1230" width="405" height="100" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-17" value="&lt;b&gt;生产者&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="374" y="1230" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-18" value="幂等" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="215" y="1255" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-19" value="重试" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="280" y="1255" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-20" value="顺序" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="344.5" y="1255" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-23" value="生产者配置：&#xa;幂等：enable.idempotence=true&#xa;重试：message.send.max.retries=3&#xa;顺序：max.in.flight.requests.per.connection=1&#xa;消息Ack: Acks=-1&#xa;发送策略：同步/异步，batch.size，等待时间(linger.ms)&#xa;元数据更新时间：metadata.max.age.ms=300000" style="shape=note;size=15;spacingLeft=5;align=left;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="700" y="1190" width="320" height="110" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-24" value="" style="edgeStyle=none;html=1;endArrow=none;rounded=0;labelBackgroundColor=none;dashed=1;exitX=0;exitY=0.473;entryX=0.998;entryY=0.45;entryDx=0;entryDy=0;entryPerimeter=0;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="J3ipS8W6sBXHcmSZQY-d-23" target="J3ipS8W6sBXHcmSZQY-d-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="775" y="1290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-25" value="Ack" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="408.5" y="1255" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-26" value="发送策略" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="473.5" y="1255" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-28" value="拦截器" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="215" y="1300" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-29" value="序列化" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="280" y="1300" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-30" value="分区/元数据" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="345" y="1300" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-31" value="收集器" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="410" y="1300" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-32" value="client" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="475" y="1300" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-34" value="压缩" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="538.5" y="1255" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-36" value="&lt;b&gt;Broker&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="380" y="1330" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-37" value="消费者组" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="215" y="1405" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-38" value="offset偏移" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="280" y="1405" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-39" value="重平衡" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="344.5" y="1405" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-40" value="broker配置：&#xa;ISR延迟时间：replica.lag.time.max.ms&#xa;日志存储:log.retention.hours=7;log.retention.bytes=1G&#xa;" style="shape=note;size=15;spacingLeft=5;align=left;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="690" y="1600" width="320" height="60" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-41" value="" style="edgeStyle=none;html=1;endArrow=none;rounded=0;labelBackgroundColor=none;dashed=1;exitX=0;exitY=0.482;entryX=1;entryY=0.876;entryDx=0;entryDy=0;entryPerimeter=0;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="J3ipS8W6sBXHcmSZQY-d-40" target="J3ipS8W6sBXHcmSZQY-d-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="775" y="1420" as="targetPoint" />
            <mxPoint x="670" y="1397.0300000000002" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-44" value="主题" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="215" y="1450" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-45" value="分区" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="280" y="1450" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-50" value="副本" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="344.25" y="1450" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-51" value="分区leader" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="409" y="1450" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-52" value="稀疏索引" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="345" y="1496" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-53" value="顺序读写" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="409" y="1496" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-54" value="日志" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="215" y="1496" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-55" value="分段" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="280" y="1496" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-56" value="ISR/OSR" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="474" y="1450" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-57" value="LEO/HW" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="539" y="1450" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-58" value="分区leader：提供了读取能力，kafka 支持自平衡，但影响性能；建议关闭，手动运维平衡。&#xa;ISR:所有与 Leader 副本保持一定程度同步的Replica(包括 Leader 副本在内)组成 ISR&#xa;OSR:与 Leader 副本同步滞后过多的 Replica 组成了 OSR&#xa;LEO:每个副本都有内部的LEO，代表当前队列消息的最后一条偏移量offset。&#xa;HW:高水位，代表所有ISR中的LEO最低的那个offset，也是消费者可见的最大消息offset。&#xa;" style="shape=note;size=15;spacingLeft=5;align=left;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="676" y="1500" width="510" height="90" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-59" value="controller" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="215" y="1360" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-60" value="元数据管理" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="279.5" y="1360" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-61" value="分区leader选举" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="343.5" y="1360" width="66.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-62" value="分区重平衡" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="409.5" y="1360" width="66.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-63" value="controller选举：集群中每个broker都会尝试在zookeeper上创建一个 /controller 临时节点，zookeeper会保证有且仅有一个broker能创建成功，这个broker就会成为集群的总控器controller，同时epoch number（纪元编号）+1。&#xa;分区leader选举：当controller 感知到分区leader所在broker崩溃，controller会重ISR中取offset最大的第一个broker 作为leader.&#xa;Controller节点的主要职能：&#xa;Broker状态管理：Controller会跟踪集群中所有Broker的在线状态，并在Broker宕机或者恢复时更新集群的状态。&#xa;分区状态管理：当新的Topic被创建，或者已有的Topic被删除时，Controller会负责管理这些变化，并更新集群的状态。&#xa;分区领导者选举：当某个分区的leader副本出现故障时，由控制器负责为该分区选举新的leader副本。&#xa;副本状态管理：当检测到某个分区的ISR集合发生变化时，由控制器负责通知所有broker更新其元数据信息&#xa;分区重平衡：当添加或删除Broker节点时，Controller会负责对Partition的分布进行重平衡，以确保数据的均匀分布。&#xa;存储集群元数据：Controller保存了集群中最全的元数据信息，并通过发送请求同步到其他Broker上面。" style="shape=note;size=15;spacingLeft=5;align=left;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="676" y="1322" width="644" height="158" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-64" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;exitX=1.015;exitY=0.533;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.453;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="J3ipS8W6sBXHcmSZQY-d-62" target="J3ipS8W6sBXHcmSZQY-d-63" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="590" y="1440" as="sourcePoint" />
            <mxPoint x="640" y="1390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-66" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;entryX=0.002;entryY=0.533;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1.031;exitY=0.7;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="J3ipS8W6sBXHcmSZQY-d-57" target="J3ipS8W6sBXHcmSZQY-d-58" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="1680" as="sourcePoint" />
            <mxPoint x="500" y="1630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-67" value="零拷贝" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="215" y="1550" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-68" value="pagecache" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="280" y="1550" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-69" value="分区负载" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="345" y="1550" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-70" value="异步批量" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="410" y="1550" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-73" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="1" vertex="1">
          <mxGeometry x="215" y="1580" width="405" height="100" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-74" value="&lt;b&gt;消费者&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="374" y="1580" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-75" value="消费组" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="215" y="1650" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-76" value="offset" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="280" y="1650" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-77" value="幂等" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="344.5" y="1650" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-78" value="分区分配" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="409.25" y="1650" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-86" value="单播/广播" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="408.5" y="1405" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-88" value="消费者配置：&#xa;enable.auto.commit=true; auto.commit.interval.ms=5000&#xa;max-poll-records：消费者每次从 Kafka 拉取的数据条数，默认是 500。&#xa;partition.assignment.strategy: 分区分配策略，range/roundrobin/sticky" style="shape=note;size=15;spacingLeft=5;align=left;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="690" y="1680" width="410" height="90" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-89" value="消费线程模型" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;" parent="1" vertex="1">
          <mxGeometry x="473" y="1650" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-90" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;entryX=-0.005;entryY=0.478;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1.005;exitY=0.47;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="J3ipS8W6sBXHcmSZQY-d-73" target="J3ipS8W6sBXHcmSZQY-d-88" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="1770" as="sourcePoint" />
            <mxPoint x="630" y="1720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="J3ipS8W6sBXHcmSZQY-d-91" value="事务" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffcd28;strokeColor=#d79b00;gradientColor=#ffa500;" parent="1" vertex="1">
          <mxGeometry x="474" y="1550" width="65" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
